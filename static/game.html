<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Details</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <header class="main-header">
        <div class="header-left">
            <span class="logo">YourStore</span>
            <nav>
                <ul>
                    <li><a href="games.html">Games</a></li>
                    <li><a href="#">Help</a></li>
                    <li><a href="#">Store</a></li>
                    <li><a href="#">Plus</a></li>
                </ul>
            </nav>
        </div>
        <div class="header-right">
            <a href="login.html" id="loginBtn" class="header-login-btn">Login</a>
            <button id="registerBtn">Register</button>
            <span id="cartIconContainer" style="display:none;">
                <a href="cart.html" id="cartIcon" class="header-cart-icon" style="margin:0 12px;">
                    <span class="material-icons" style="font-size:28px;vertical-align:middle;color:#fff;">shopping_cart</span>
                </a>
            </span>
            <div class="header-user-menu" id="headerUserMenu" style="display: none;">
                <button class="user-menu-btn" id="userMenuBtn">
                    <span class="user-avatar" id="userAvatar">A</span>
                    <span class="user-name" id="userName"></span>
                    <svg class="user-menu-arrow" width="16" height="16" viewBox="0 0 24 24"><path fill="#fff" d="M7 10l5 5 5-5z"/></svg>
                </button>
                <div class="user-dropdown" id="userDropdown" style="display: none;">
                    <ul>
                        <li><a href="#">My Achievements</a></li>
                        <li><a href="#">Epic Rewards</a></li>
                        <li><a href="#">Epic Wallet</a></li>
                        <li><a href="#">Coupons</a></li>
                        <li><a href="#">Account</a></li>
                        <li><a href="#">Redeem Code</a></li>
                        <li><a href="#">Wishlist</a></li>
                        <li><a href="#" id="signOutBtn">Sign Out</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <main>
        <section class="game-details-container">
            <div class="game-details-main">
                <div class="game-details-media">
                    <div class="game-media-carousel">
                        <div class="game-media-main" id="gameMediaMain"></div>
                        <div class="game-media-thumbs" id="gameMediaThumbs"></div>
                    </div>
                    <div class="game-type-row">
                        <span class="game-type-icon" id="gameTypeIcon">ðŸŽ®</span>
                        <span class="game-type-label" id="gameTypeLabel"></span>
                    </div>
             
                    <div id="gameDetailsDesc" class="game-details-desc"></div>
                </div>
                <div class="game-details-info">
                    <img id="gameDetailsLogo" class="game-details-logo" src="" alt="Game Logo" style="display:none;">
                    <div class="game-details-age" id="gameDetailsAge" style="display:none;">
                        <img id="gameDetailsAgeImg" src="" alt="Age Rating">
                        <span class="game-details-age-text" id="gameDetailsAgeText"></span>
                    </div>
                    <span class="game-details-badge" id="gameDetailsBadge" style="display:none;"></span>
                    <div class="game-details-price" id="gameDetailsPrice"></div>
                    <button id="buyNowBtn" class="game-details-main-btn">Buy Now</button>
                    <button id="addToCartBtn" class="game-details-sub-btn">Add To Cart</button>
                    <button id="addToWishlistBtn" class="game-details-sub-btn">Add to Wishlist</button>
                    <div class="game-details-info-list" id="gameDetailsInfoList"></div>
                </div>
            </div>
            <!-- Add more sections for achievements, editions, DLC, etc. as needed -->
        </section>
        <section id="gameExtraSection" style="display:none; margin-top:32px;">
            <h2 id="gameExtraTitle"></h2>
            <div id="gameExtraContent"></div>
        </section>
    </main>
    <footer>
        <div class="footer-links">
            <a href="#">About</a>
            <a href="#">Contact</a>
            <a href="#">Terms</a>
            <a href="#">Privacy</a>
        </div>
        <div class="footer-bottom">&copy; 2025 YourStore. All rights reserved.</div>
    </footer>
    <script src="game.js"></script>
    <script>
    // Show extra section if data is present (achievements, editions, DLC, etc.)
    document.addEventListener('DOMContentLoaded', function() {
        if (window.gameExtra && window.gameExtra.title && window.gameExtra.content) {
            document.getElementById('gameExtraSection').style.display = '';
            document.getElementById('gameExtraTitle').textContent = window.gameExtra.title;
            document.getElementById('gameExtraContent').innerHTML = window.gameExtra.content;
        }
    });
    </script>
    
<script>
document.addEventListener('DOMContentLoaded', () => {
    const addToCartBtn = document.getElementById('addToCartBtn');
    if (!addToCartBtn) return;
    // Get gameId from URL param (same as in game.js)
    function getQueryParam(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }
    const gameId = getQueryParam('id');
    // Get JWT token from localStorage or cookie (support both 'jwt_token' and 'jwt')
    function getJwtToken() {
        let token = localStorage.getItem('jwt_token');
        if (token) return token;
        // Try jwt_token cookie
        let match = document.cookie.match(/(?:^|; )jwt_token=([^;]*)/);
        if (match) return decodeURIComponent(match[1]);
        // Try jwt cookie (this is what backend sets)
        match = document.cookie.match(/(?:^|; )jwt=([^;]*)/);
        if (match) return decodeURIComponent(match[1]);
        return null;
    }
    addToCartBtn.addEventListener('click', async () => {
        const token = getJwtToken();
        if (!token) {
            showCartErrorPopup('You must be logged in to add to cart.');
            return;
        }
        addToCartBtn.disabled = true;
        const originalText = addToCartBtn.textContent;
        addToCartBtn.textContent = 'Adding...';
        try {
            const response = await fetch('http://127.0.0.1:5000/api/cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ game_id: gameId })
            });
            const data = await response.json();
            if (!response.ok) {
                showCartErrorPopup(data.error || 'Failed to add to cart.');
            } else {
                showCartSuccessPopup('Game added to cart!');
            }
        } catch (err) {
            showCartErrorPopup('Failed to add to cart.');
        }
        addToCartBtn.disabled = false;
        addToCartBtn.textContent = originalText;
    });

    // Modern popup functions (copied from game.js for inline use)
    window.showCartSuccessPopup = function(msg) {
        let popup = document.createElement('div');
        popup.className = 'registration-complete-popup';
        popup.innerHTML = `
            <div class="popup-content">
                <svg width="48" height="48" fill="none" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="12" fill="#1ba9ff"/>
                    <path d="M7 13l3 3 7-7" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="popup-title">Success</div>
                <div class="popup-msg">${msg}</div>
            </div>
        `;
        document.body.appendChild(popup);
        setTimeout(() => { popup.classList.add('show'); }, 10);
        setTimeout(() => { popup.classList.remove('show'); setTimeout(()=>popup.remove(), 400); }, 2400);
    }
    window.showCartErrorPopup = function(msg) {
        let popup = document.createElement('div');
        popup.className = 'registration-complete-popup';
        popup.innerHTML = `
            <div class="popup-content">
                <svg width="48" height="48" fill="none" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="12" fill="#ff6f61"/>
                    <path d="M12 8v4m0 4h.01" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <div class="popup-title">Error</div>
                <div class="popup-msg">${msg}</div>
            </div>
        `;
        document.body.appendChild(popup);
        setTimeout(() => { popup.classList.add('show'); }, 10);
        setTimeout(() => { popup.classList.remove('show'); setTimeout(()=>popup.remove(), 400); }, 2400);
    }
});
</script>

<script>
    // Show cart icon only if user is logged in
    (function() {
        function getToken() {
            let token = localStorage.getItem('jwt_token');
            if (token) return token;
            let match = document.cookie.match(/(?:^|; )jwt_token=([^;]*)/);
            if (match) return decodeURIComponent(match[1]);
            match = document.cookie.match(/(?:^|; )jwt=([^;]*)/);
            if (match) return decodeURIComponent(match[1]);
            return null;
        }
        if (getToken()) {
            var cartIcon = document.getElementById('cartIconContainer');
            if (cartIcon) cartIcon.style.display = '';
        }
    })();
    </script>


</body>
</html>
